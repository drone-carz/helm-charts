kind: pipeline
type: kubernetes
name: default

steps:
- name: publish-vscode-image
  image: banzaicloud/drone-kaniko:0.6.0
  settings:
    registry: raizenanalyticsdev.azurecr.io
    repo: code-server
    auto_tag: true
    username: raizenanalyticsdev
    password:
      from_secret: azure-registry-key
    context: /drone/src/images/code-server/
  resources:
    requests:
      memory: 1GiB
  when:
    branch:
    - master
    event:
    - tag

- name: publish-ws-tunnel-server
  image: banzaicloud/drone-kaniko:0.6.0
  settings:
    registry: raizenanalyticsdev.azurecr.io
    repo: ws-tunnel-server
    auto_tag: true
    username: raizenanalyticsdev
    password:
      from_secret: azure-registry-key
    context: /drone/src/images/ws-tunnel/server
  resources:
    requests:
      memory: 1GiB
  when:
    branch:
    - master
    event:
    - tag

- name: publish-ws-tunnel-client
  image: banzaicloud/drone-kaniko:0.6.0
  settings:
    registry: raizenanalyticsdev.azurecr.io
    repo: ws-tunnel-client
    auto_tag: true
    username: raizenanalyticsdev
    password:
      from_secret: azure-registry-key
    context: /drone/src/images/ws-tunnel/client
  resources:
    requests:
      memory: 1GiB
  when:
    branch:
    - master
    event:
    - tag